<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>BaseFlow</title>
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <div id="container">
            <div id="toolbar">
                <button onclick="
                if(!saved && !isEmpty()){
                    document.getElementById('new-popup').classList = 'active'
                    document.getElementById('overlay').classList = 'active'
                }
                else{
                    location.reload()
                }
                ">New</button>
                <button onclick="document.getElementById('fileInput').click()">Open</button>
                <input type="file" id="fileInput" style="display:none;" accept=".json" multiple="false" />
                <button onclick="saveFile()">Save</button>
                <button onclick="run()">Run</button>
            </div>
            <div id="main">
                <div id="sidebar">
                    <label for="sidebar" id="variabiliLabel">VARIABLES</label>
                    <div id="tableContainer">
                        <table id="tabVariabili">
                        <tr> 
                            <th>Name</th>
                            <th>Type</th>
                            <th>Value</th>
                        </tr>
                        <tr>
                            <td>
                                <input class="inputVariable" type ="text">
                            </td>
                            <td>
                                <select class="inputVariable">
                                    <option value="int">Integer</option>
                                    <option value="float">Float</option>
                                    <option value="string">String</option>
                                </select>
                            </td>
                            <td>
                                <input class="inputVariable" type ="text">
                            </td>
                        </tr>
                    </table>
                    </div>
                    
                </div>
                
                <div id="canvas-container">
                    <canvas id="canvas" width="800" height="600"></canvas>
                    <div id="popup-window">
                        <div class="section" id="io-section">
                            <h3>I/O</h3>
                            <button id="input-btn" onclick="inserisciNodo('input')" class="io-btn">Input</button>
                            <button id="output-btn" onclick="inserisciNodo('print')" class="io-btn">Output</button>
                        </div>
                        <div class="section" id="variables-section">
                            <h3>Variables</h3>
                            <button id="assign-btn" onclick="inserisciNodo('assign')" class="variables-btn">Assign</button>
                        </div>
                        <div class="section" id="control-section">
                            <h3>Control</h3>
                            <button id="if-btn" onclick="inserisciNodo('if')" class="control-btn">If</button>
                        </div>
                        <div class="section" id="loops-section">
                            <h3>Loops</h3>
                            <button id="while-btn" class="loops-btn">While</button>
                            <button id="for-btn" class="loops-btn">For</button>
                            <button id="do-while-btn" class="loops-btn">Do-While</button>
                        </div>
                        <button id="close-popup" onclick="chiudiPopup()">Chiudi</button>
                    </div>
                    
                    <div id="edit-node-popup">
                        <h3>Edit Node</h3>
                        <input type="text" id="edit-node-input" placeholder="Enter node information">
                        <button id="save-node-info" onclick="salvaInfo()">Salva</button>
                        <button id="close-edit-popup" onclick="chiudiEditPopup()">Chiudi</button>
                    </div>

                    <div id="save-popup">
                        <h3>Save project</h3>
                        <label for="filename-input">File name (without extension):</label><br>
                        <input type="text" id="filename-input" placeholder="Insert file name"><br><br>
                        <button id="save-confirm-btn" onclick="save(flow,document.getElementById('filename-input').value)">Save</button>
                        <button id="save-cancel-btn" onclick="closeSavePopup()">Cancel</button>
                    </div>

                    <div id="new-popup" >
                        <p>Do you want to continue without saving?</p>
                        <button id="save-btn" onclick="document.getElementById('new-popup').classList.remove('active')
                        document.getElementById('overlay').classList.remove('active')
                        saveFile()">Save</button>
                        <button id="continue-btn" onclick="location.reload()">New</button>
                        <button id="cancel-btn" onclick="document.getElementById('overlay').classList.remove('active');
                        document.getElementById('new-popup').classList.remove('active');">Cancel</button>
                    </div>

                    <div id="console-popup">
                        <div id="console-buttons">
                            <button onclick="(async () => {
                                        await executeFlow(flow);
                                    })();" id="console-exe">Execute</button>
                            <button onclick="(async () => {
                                        await executeStep();
                                    })();" id="console-step">Step</button>
                            <button onclick="resetFlow()" id="console-reset">Reset</button>
                            <button onclick="clearConsole()" id="console-clear">Clear</button>
                            <button onclick="closeConsole()" id="console-close">Close</button>
                        </div>
                        <div id="console-output" role="log">
                            <p>> Console ready...</p>
                        </div>
                        <div id="console-input-section">
                            <input type="text" id="console-input"  placeholder="Enter a value...">
                            <button id="console-send">Send</button>
                        </div>
                    </div>

                    <div id="overlay" ></div>
                </div>
            </div>
            
        </div>
        
        <script src="script.js"></script>
        <script src="execute.js"></script>
        <script src="saveOpen.js"></script>
    </body>
</html>